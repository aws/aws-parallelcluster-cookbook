# Allows to test single recipes
#
# Must be run as local file (override) of kitchen.docker.yml
# export KITCHEN_YAML=kitchen.docker.yml
# export KITCHEN_LOCAL_YAML=kitchen.recipes.yml
# See: https://kitchen.ci/docs/reference/configuration
---
verifier:
  name: inspec
  inspec_tests:
    # recipe tests will use controls from these directories
    - test/recipes
    - test/resources

suites:
  - name: sudo
    run_list:
      - recipe[aws-parallelcluster-install::sudo]
    verifier:
      controls:
        - sudo
  - name: users
    run_list:
      - recipe[aws-parallelcluster::test_dummy]
      - recipe[aws-parallelcluster-install::users]
    verifier:
      controls:
        - admin_user
        - ulimit
  - name: directories
    run_list:
      - recipe[aws-parallelcluster-install::directories]
    verifier:
      controls:
        - pcluster_directories_exist
        - pcluster_log_dir_is_configured

  - name: ephemeral_drives_setup
    run_list:
      - recipe[aws-parallelcluster-install::ephemeral_drives]
    verifier:
      controls:
        - 'Ephemeral drives script is copied to the target dir'
        - 'Ephemeral service is set up to run ephemeral drives script'

  - name: python_setup
    run_list:
      - recipe[aws-parallelcluster-install::directories]
      - recipe[aws-parallelcluster-install::python]
    verifier:
      controls:
        - 'awsbatch_virtualenv_installed'
        - 'cookbook_virtualenv_installed'
        - 'node_virtualenv_installed'
        - 'cfnbootstrap_virtualenv_installed'
