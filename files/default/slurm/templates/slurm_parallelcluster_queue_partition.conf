# This file is automatically generated by pcluster
{% set has_node = namespace(has_node=false) %}

{% for instance_type, instance_info in queue.instances.items() %}
    {% set has_static_nodes = true if instance_info.static_size > 0 else false %}
    {% set has_dynamic_nodes = true if instance_info.dynamic_size > 0 else false %}
    {% if has_static_nodes %}
NodeName={{ queue.queue_name }}-static-{{ instance_type }}-[1-{{ instance_info.static_size }}] CPUs={{ instance_info.vcpus }} State=CLOUD Feature=static,{{ instance_type }}{% if instance_info.gpus > 0 %},gpu Gres=gpu:tesla:{{ instance_info.gpus }}{% endif %} 
    {% endif %}
    {% if has_dynamic_nodes %}
NodeName={{ queue.queue_name }}-dynamic-{{ instance_type }}-[1-{{ instance_info.dynamic_size }}] CPUs={{ instance_info.vcpus }} State=CLOUD Feature=dynamic,{{ instance_type }}{% if instance_info.gpus > 0 %},gpu Gres=gpu:tesla:{{ instance_info.gpus }}{% endif %} 
    {% endif %}
    {% if has_static_nodes or has_dynamic_nodes %}
        {% set has_node.has_node = true %}
    {% endif %}
{% endfor %}
{% if has_node.has_node -%}
NodeSet={{ queue.queue_name }}_nodes Nodes={% for instance_type, instance_info in queue.instances.items() %}
        {% set has_static_nodes = true if instance_info.static_size > 0 else false %}
        {% set has_dynamic_nodes = true if instance_info.dynamic_size > 0 else false %}
        {%- if has_static_nodes and has_dynamic_nodes -%}
{{ queue.queue_name }}-static-{{ instance_type }}-[1-{{ instance_info.static_size }}],{{ queue.queue_name }}-dynamic-{{ instance_type }}-[1-{{ instance_info.dynamic_size }}]
        {%- elif has_static_nodes -%}
{{ queue.queue_name }}-static-{{ instance_type }}-[1-{{ instance_info.static_size }}]
        {%- elif has_dynamic_nodes -%}
{{ queue.queue_name }}-dynamic-{{ instance_type }}-[1-{{ instance_info.dynamic_size }}]
        {%- endif -%}
    {{- "," if not loop.last else "" -}}
    {% endfor %}

PartitionName={{ queue.queue_name }} Nodes={{ queue.queue_name }}_nodes MaxTime=INFINITE State=UP{% if queue.is_default is sameas true %} Default=YES{% endif %} 
{% endif %}
