---
verifier:
  name: inspec
  inspec_tests:
    - test

suites:
  - name: sudo
    run_list:
      - recipe[aws-parallelcluster-platform::sudo_install]
    verifier:
      controls:
        - /tag:install_sudo/
  - name: users
    run_list:
      - recipe[aws-parallelcluster-platform::users]
    verifier:
      controls:
        - /tag:install_users/
  - name: directories
    run_list:
      - recipe[aws-parallelcluster-platform::directories]
    verifier:
      controls:
        - /pcluster_directories_exist/
        - /pcluster_log_dir_is_configured/
  - name: disable_services
    run_list:
      - recipe[aws-parallelcluster-platform::disable_services]
    verifier:
      controls:
        - /services_disabled/
  - name: cookbook_virtualenv
    run_list:
      - recipe[aws-parallelcluster-platform::cookbook_virtualenv]
    verifier:
      controls:
        - /cookbook_virtualenv_created/
  - name: awscli
    run_list:
      - recipe[aws-parallelcluster-tests::setup]
      - recipe[aws-parallelcluster-platform::awscli]
    verifier:
      controls:
        - /awscli_installed/
        - /awscli_can_run_as/
    attributes:
      dependencies:
        - recipe:aws-parallelcluster-platform::directories
        - recipe:aws-parallelcluster-platform::cookbook_virtualenv
  - name: openssh
    run_list:
      - recipe[aws-parallelcluster-tests::setup]
      - recipe[openssh]
    verifier:
      controls:
        - /openssh_installed/
    attributes:
      dependencies:
        - resource:package_repos:update
  - name: disable_selinux
    run_list:
      - recipe[aws-parallelcluster-platform::disable_selinux]
    verifier:
      controls:
        - /tag:install_selinux_disabled/
  - name: license_readme
    run_list:
      - recipe[aws-parallelcluster-tests::setup]
      - recipe[aws-parallelcluster-platform::license_readme]
    verifier:
      controls:
        - /license_readme_created/
  - name: gc_thresh_values
    run_list:
      - recipe[aws-parallelcluster-tests::setup]
      - recipe[aws-parallelcluster-platform::gc_thresh_values]
    verifier:
      controls:
        - /gc_thresh_values/
  - name: supervisord_setup
    run_list:
      - recipe[aws-parallelcluster-platform::supervisord]
    verifier:
      controls:
        - /tag:install_supervisord/
