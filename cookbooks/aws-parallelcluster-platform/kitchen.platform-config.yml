---
verifier:
  name: inspec
  inspec_tests:
    - test

suites:
  - name: chrony
    run_list:
      - recipe[aws-parallelcluster-tests::setup]
      - recipe[aws-parallelcluster-tests::test_resource]
    verifier:
      controls:
        - /tag:config_chrony/
    attributes:
      resource: chrony:enable
      dependencies:
      - resource:chrony:setup
  - name: ssh_target_checker
    run_list:
      - recipe[aws-parallelcluster-platform::openssh]
    verifier:
      controls:
        - ssh_target_checker_script_created
    attributes:
      ec2:
        mac: mac1
        network_interfaces_macs:
          mac1:
            vpc_ipv4_cidr_blocks: |
              cidr1
              cidr2
  - name: fabric_manager
    run_list:
      - recipe[aws-parallelcluster-tests::setup]
      - recipe[aws-parallelcluster-tests::test_resource]
    verifier:
      controls:
        - /tag:config_.*fabric_manager/
    attributes:
      resource: fabric_manager:configure
      cluster:
        nvidia:
          enabled: true
      dependencies:
        - resource:fabric_manager:setup
    driver:
      instance_type: g4dn.2xlarge
  - name: nvidia_gdrcopy
    # doesn't work on Docker
    run_list:
      - recipe[aws-parallelcluster-tests::setup]
      - recipe[aws-parallelcluster-tests::test_resource]
    verifier:
      controls:
        - /tag:config_.*gdrcopy/
    attributes:
      resource: gdrcopy:configure
      cluster:
        nvidia:
          enabled: true
    driver:
      instance_type: g4dn.2xlarge
