{%- import 'common/slurm_parallelcluster_utils.conf' as slurm_utils with context -%}

# This file is automatically generated by pcluster
{% for compute_resource in queue_config.ComputeResources %}
    {#- All instance types are expected to have the same no of gpus & cpus from the same manufacturer #}
    {% set instance_type = compute_resource | get_instance_type %}

    {%- set gpus = compute_resource | gpus -%}
    {%- if gpus.count > 0 %}
        {% set static_size = compute_resource.MinCount %}
        {% set dynamic_size = compute_resource.MaxCount - compute_resource.MinCount %}
        {% if static_size > 0 %}
            {{- slurm_utils.node_name_property(queue_name, compute_resource.Name, static_size, True) }} Name=gpu Type={{ gpus.type }} File=/dev/nvidia[0-{{ gpus.count - 1 }}]
        {% endif %}
        {% if dynamic_size > 0 %}
            {{- slurm_utils.node_name_property(queue_name, compute_resource.Name, dynamic_size, False) }} Name=gpu Type={{ gpus.type }} File=/dev/nvidia[0-{{ gpus.count - 1 }}]
        {% endif %}
    {% endif %}
{% endfor %}
