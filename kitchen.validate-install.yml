# Validates orchestration recipes
---
verifier:
  name: inspec
  inspec_tests:
    - test/recipes
    - test/resources
    - /tmp/cookbooks/aws-parallelcluster-platform/test
    - /tmp/cookbooks/aws-parallelcluster-environment/test
    - /tmp/cookbooks/aws-parallelcluster-computefleet/test

lifecycle:
  pre_verify:
    - local: . ./kitchen.fix-inspec-deps.sh

suites:
  - name: aws_parallelcluster_install
    run_list:
      - recipe[aws-parallelcluster-test::docker_mock]
      - recipe[aws-parallelcluster]
      - recipe[aws-parallelcluster-tests::tear_down]
    verifier:
      controls:
        # We also need to test the effect some files (service config, profile config) have on the system.
        # TODO: rethink and integrate
        - sudo_installed
        - sudoers_file_configured
        - admin_user_created
        - ulimit_configured
        - pcluster_directories_exist
        - pcluster_log_dir_is_configured
        - awsbatch_virtualenv_created
        - cookbook_virtualenv_created
        - cfnbootstrap_virtualenv_created
        - node_virtualenv_created
        - install_packages
        - node_attributes_created
        - /services_disabled_on_amazon_family/
        - /services_disabled_on_debian_family/
        - /nvidia_driver/
        - /fabric_manager/
        - /tag:install/
