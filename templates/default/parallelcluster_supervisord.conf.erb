# Generated by Chef for AWS ParallelCluster <%= node['cfncluster']['cfn_node_type'] -%>
# Local modifications could be be overwritten.
<% case node['cfncluster']['cfn_node_type'] -%>
<%# MasterServer -%>
<% when 'MasterServer' -%>
<% if node['cfncluster']['cfn_scheduler'] == 'slurm' -%>
[program:cfn-hup]
command = <%= node['cfncluster']['cookbook_virtualenv_path'] %>/bin/python <%= node['cfncluster']['cookbook_virtualenv_path'] %>/bin/cfn-hup
# The following are needed because cfn-hup starts as a daemon
exitcodes = 0
autorestart = unexpected
startsecs = 0

[program:clustermgtd]
command = <%= node['cfncluster']['node_virtualenv_path'] %>/bin/clustermgtd
redirect_stderr = true
stdout_logfile = /var/log/parallelcluster/clustermgtd
<% end -%>

<% if node['cfncluster']['dcv_enabled'] == "master" && node['conditions']['dcv_supported'] -%>
[program:pcluster_dcv_authenticator]
command = <%= node['cfncluster']['dcv']['authenticator']['virtualenv_path'] %>/bin/python <%= node['cfncluster']['dcv']['authenticator']['user_home'] %>/pcluster_dcv_authenticator.py
      --port <%= Integer(node['cfncluster']['dcv_port']) + 1 %>
      --certificate <%= node['cfncluster']['dcv']['authenticator']['certificate'] %>
      --key <%= node['cfncluster']['dcv']['authenticator']['private_key'] %>
user = <%= node['cfncluster']['dcv']['authenticator']['user'] %>
environment = HOME="<%= node['cfncluster']['dcv']['authenticator']['user_home'] %>",USER="<%= node['cfncluster']['dcv']['authenticator']['user'] %>"
<% end -%>

<%# ComputeFleet -%>
<% when 'ComputeFleet' -%>
<% if node['cfncluster']['cfn_scheduler'] == 'slurm' -%>
[program:computemgtd]
command = <%= node['cfncluster']['node_virtualenv_path'] %>/bin/computemgtd
redirect_stderr = true
stdout_logfile = /var/log/parallelcluster/computemgtd
<% end -%>

<% end -%>
